<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Azad Haber | Admin Paneli</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; }
    .admin-container { max-width: 900px; margin: 30px auto; }
    input, textarea, button { width: 100%; padding: 10px; margin-bottom: 10px; }
    button { background: #e63946; color: white; border: none; cursor: pointer; }
    .input-file { padding: 10px; background: #fff; border: 1px solid #ccc; border-radius: 5px; }
  </style>
</head>
<body>

<div class="admin-container">
  <h2>Yeni Haber Ekle</h2>
  
  <input type="text" id="newsTitle" placeholder="Haber Başlığı">
  <textarea id="newsContent" placeholder="Haber İçeriği"></textarea>
  <input type="file" id="newsImage" class="input-file" accept="image/*">
  <select id="newsCategory">
    <option value="guncel">Güncel</option>
    <option value="politika">Politika</option>
    <option value="ekonomi">Ekonomi</option>
    <option value="spor">Spor</option>
  </select>
  <label>
    <input type="checkbox" id="isFeatured"> Ana Sayfada Göster
  </label>
  
  <button id="addNewsBtn">Haberi Kaydet</button>
  
  <div id="newsStatus" style="color:green;"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";
  import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

  // Firebase konfigürasyonu
  const firebaseConfig = {
    apiKey: "API_KEYİNİZ",
    authDomain: "azadhaber1.firebaseapp.com",
    databaseURL: "https://azadhaber1-default-rtdb.firebaseio.com",
    projectId: "azadhaber1",
    storageBucket: "azadhaber1.appspot.com",
    messagingSenderId: "307978936562",
    appId: "1:307978936562:web:7eb007183210681d306b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const storage = getStorage(app);

  function slugify(text){
    return text.toString().toLowerCase().replace(/\s+/g,'-').replace(/[^\w\-]+/g,'').replace(/\-\-+/g,'-').replace(/^-+/,'').replace(/-+$/,'');
  }

  // Form elemanları
  const addNewsBtn = document.getElementById("addNewsBtn");
  addNewsBtn.addEventListener("click", async () => {
    const title = document.getElementById("newsTitle").value.trim();
    const content = document.getElementById("newsContent").value.trim();
    const category = document.getElementById("newsCategory").value;
    const isFeatured = document.getElementById("isFeatured").checked;
    const fileInput = document.getElementById("newsImage");

    if (!title || !content || !fileInput.files[0]) {
      alert("Tüm alanlar doldurulmalıdır!");
      return;
    }

    const imageFile = fileInput.files[0];
    const slug = slugify(title);
    const imageRef = storageRef(storage, 'images/' + slug + '-' + imageFile.name);

    try {
      // Resim dosyasını yükleme
      const uploadResult = await uploadBytes(imageRef, imageFile);
      const imageUrl = await getDownloadURL(uploadResult.ref);  // Yüklenen dosyanın URL'sini al

      // Haber verilerini Firebase'e ekleme
      const newsRef = ref(db, "haberler/" + category);
      const newNews = {
        title,
        content,
        image: imageUrl,
        slug,
        isFeatured, // Ana sayfada gösterme durumu
      };

      await push(newsRef, newNews);

      // Başarı mesajı ve form temizleme
      document.getElementById("newsStatus").textContent = "Haber başarıyla eklendi!";
      document.getElementById("newsTitle").value = "";
      document.getElementById("newsContent").value = "";
      document.getElementById("newsImage").value = "";
      document.getElementById("isFeatured").checked = false;

    } catch (error) {
      console.error("Hata oluştu: ", error);
      document.getElementById("newsStatus").textContent = "Haber eklenirken bir hata oluştu.";
    }
  });
</script>

</body>
</html>
